local function setupGUI()
    -- Create GUI container
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "PetRandomizerGUI"
    screenGui.ResetOnSpawn = false
    screenGui.Parent = game:GetService("Players").LocalPlayer:WaitForChild("PlayerGui")

    local mainFrame = Instance.new("Frame")
    mainFrame.Name = "MainFrame"
    mainFrame.Size = UDim2.new(0, 250, 0, 200)
    mainFrame.Position = UDim2.new(0.02, 0, 0.2, 0)
    mainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    mainFrame.BorderSizePixel = 0
    mainFrame.Parent = screenGui

    local layout = Instance.new("UIListLayout")
    layout.SortOrder = Enum.SortOrder.LayoutOrder
    layout.Padding = UDim.new(0, 6)
    layout.Parent = mainFrame

    local padding = Instance.new("UIPadding")
    padding.PaddingTop = UDim.new(0, 10)
    padding.PaddingBottom = UDim.new(0, 10)
    padding.PaddingLeft = UDim.new(0, 10)
    padding.PaddingRight = UDim.new(0, 10)
    padding.Parent = mainFrame

    -- Styled button creator function
    local function createStyledButton(text, parent, onClickFunction, bgColor)
        local button = Instance.new("TextButton")
        button.Size = UDim2.new(1, 0, 0, 40)
        button.BackgroundColor3 = bgColor or Color3.fromRGB(40, 40, 40)
        button.Text = text
        button.Font = Enum.Font.GothamBold
        button.TextColor3 = Color3.new(1, 1, 1)
        button.TextScaled = true
        button.AutoButtonColor = false
        button.Parent = parent

        -- Add a UIStroke for a subtle border effect
        local uiStroke = Instance.new("UIStroke")
        uiStroke.Color = Color3.fromRGB(60, 60, 60)
        uiStroke.Thickness = 1
        uiStroke.Parent = button

        -- Visual feedback on button press
        local originalColor = button.BackgroundColor3
        button.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                button.BackgroundColor3 = originalColor:Lerp(Color3.new(0.3, 0.3, 0.3), 0.5)
            end
        end)
        button.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                button.BackgroundColor3 = originalColor
            end
        end)

        button.MouseButton1Click:Connect(onClickFunction)
        return button
    end

    -- Randomize Pets Button
    local randomizePetsBtn = createStyledButton("Randomize Pets", mainFrame, function()
        for objectId, data in pairs(displayedEggs) do
            if data and data.eggName and data.label then
                local pet = getNonRepeatingRandomPet(data.eggName, data.lastPet)
                if pet then
                    data.label.Text = data.eggName .. " | " .. pet
                    data.lastPet = pet
                else
                    warn("Could not reroll pet for egg ID:", objectId)
                end
            end
        end
    end, Color3.fromRGB(255, 140, 0))
    randomizePetsBtn.LayoutOrder = 1

    -- ESP Toggle Button
    local espToggleBtn = createStyledButton("ESP: ON", mainFrame, function()
        espOn = not espOn
        espToggleBtn.Text = espOn and "ESP: ON" or "ESP: OFF"

        for objectId, data in pairs(displayedEggs) do
            if data and data.egg then
                local egg = data.egg
                local eggName = egg:GetAttribute("EggName")
                local labelText = eggName

                if not realESP[eggName] then
                    labelText = eggName .. " | " .. (data.lastPet or "?")
                end

                if espOn then
                    if not data.gui or not data.gui.Parent or not data.gui.Adornee then
                        if data.gui then data.gui:Destroy() end
                        displayedEggs[objectId] = nil
                        addESP(egg)
                    else
                        data.gui.Enabled = true
                    end
                else
                    if data.gui then
                        data.gui.Enabled = false
                    end
                end
            else
                if displayedEggs[objectId] and displayedEggs[objectId].gui then
                    displayedEggs[objectId].gui:Destroy()
                end
                displayedEggs[objectId] = nil
            end
        end

        if espOn then
            for _, egg in collectionService:GetTagged("PetEggServer") do
                local currentObjectId = egg:GetAttribute("OBJECT_UUID")
                if currentObjectId then
                    if not displayedEggs[currentObjectId] or (displayedEggs[currentObjectId].gui and not displayedEggs[currentObjectId].gui.Enabled) then
                        addESP(egg)
                    end
                end
            end
        end
    end, Color3.fromRGB(45, 45, 45))
    espToggleBtn.LayoutOrder = 2

    -- âœ… Discord Button
    local discordBtn = createStyledButton("Join Discord", mainFrame, function()
        if setclipboard then
            setclipboard("https://discord.gg/TuCuqHXC6G")
            print("Pet Randomizer Script: Discord invite link copied to clipboard.")
            
            -- Visual feedback (flash green)
            local originalColor = discordBtn.BackgroundColor3
            discordBtn.BackgroundColor3 = Color3.fromRGB(0, 170, 0)
            task.delay(0.4, function()
                discordBtn.BackgroundColor3 = originalColor
            end)
        else
            warn("Clipboard not supported in this environment.")
        end
    end, Color3.fromRGB(88, 101, 242)) -- Discord color
    discordBtn.LayoutOrder = 3

    espToggleBtn.Text = espOn and "ESP: ON" or "ESP: OFF"
end
